---
name: sqlite_integration
status: stable
confidence: 0.93
extraction_method: triangulation
sources: [code, docs, tests, examples]

metadata:
  tagline: "Thin SQLite wrapper with JSON-friendly helpers"
  category: database
  added_in: "0.1.0"
  stability: stable

summary: |
  SQLite integration provides a thin wrapper over cl-sqlite with helpers
  optimized for JSON API development. The with-db macro manages connections,
  ensure-table provides declarative schema management, and conversion helpers
  (row-to-hash, rows-to-json) enable seamless integration with JSON responses.

purpose:
  user_benefit: "Use SQLite with minimal boilerplate and automatic JSON serialization"
  problem_solved: "Manual database connection management and row-to-JSON conversion"
  alternatives: "Direct cl-sqlite usage (more verbose, manual conversion)"

key_capabilities:
  - "with-db macro for automatic connection management"
  - "ensure-table for declarative table creation"
  - "row-to-hash and rows-to-json for JSON-friendly data conversion"
  - "last-insert-id for retrieving auto-increment IDs"
  - "with-transaction for transactional operations"
  - "*db* special variable for connection access"

contracts:
  - with-db
  - ensure-table
  - last-insert-id
  - row-to-hash
  - rows-to-json
  - with-transaction
  - db-special-variable

scenarios:
  - open-database-connection
  - create-table-if-not-exists
  - insert-and-get-id
  - query-rows-as-json
  - run-transaction
  - convert-row-to-hash-table

properties:
  - with-db-binds-db-special-variable
  - ensure-table-idempotent
  - last-insert-id-returns-rowid
  - row-to-hash-uses-equal-test
  - rows-to-json-returns-list-of-hashes
  - with-transaction-commits-on-success
  - with-transaction-rolls-back-on-error

dependencies:
  required:
    - sqlite
  optional: []

implementation_notes:
  - "Thin wrapper - re-exports most cl-sqlite operations"
  - "Hash tables use :test 'equal for string keys"
  - "ensure-table uses CREATE TABLE IF NOT EXISTS"
  - "last-insert-id wraps sqlite:last-insert-rowid"
  - "Transaction support via cl-sqlite:with-transaction"

testing_status:
  unit_tests: "Excellent (sqlite-tests.lisp)"
  integration_tests: "Excellent (todo-api example)"
  coverage_gaps: []

related_features:
  - json_serialization
  - response_helpers
  - routing

evidence:
  code: "src/sqlite.lisp"
  docs: "README.md:148-164; docs/03-database.md"
  tests: "tests/sqlite-tests.lisp (12+ tests)"
  examples: "examples/todo-api.lisp (full CRUD workflow)"
